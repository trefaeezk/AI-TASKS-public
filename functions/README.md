# دوال Firebase للمؤسسات والمستخدمين الفرديين

هذا المشروع يحتوي على دوال Firebase للمؤسسات والمستخدمين الفرديين، مع الحفاظ على الخصوصية وفصل البيانات.

## هيكل المشروع

```
functions-organization/
├── src/
│   ├── index.ts                # نقطة الدخول الرئيسية
│   ├── roles.ts                # دوال إدارة الأدوار
│   ├── roles-http.ts           # دوال إدارة الأدوار (HTTP)
│   ├── system.ts               # دوال إدارة النظام
│   ├── utils.ts                # ملف مساعد قديم (للتوافق)
│   ├── individual/             # دوال المستخدمين الفرديين
│   │   ├── index.ts            # دوال المستخدمين الفرديين
│   │   └── utils.ts            # وظائف مساعدة للمستخدمين الفرديين
│   ├── organization/           # دوال المؤسسات
│   │   ├── index.ts            # دوال المؤسسات
│   │   └── utils.ts            # وظائف مساعدة للمؤسسات
│   └── shared/                 # دوال ووظائف مشتركة
│       ├── permissions.ts      # وظائف إدارة الصلاحيات
│       └── utils.ts            # وظائف مساعدة مشتركة
├── lib/                        # ملفات JavaScript المجمعة
├── package.json                # تبعيات المشروع
├── firebase.json               # تكوين Firebase
└── .firebaserc                 # تكوين مشروع Firebase
```

## هيكل قاعدة البيانات

```
firestore/
├── individuals/                # مجموعة المستخدمين الفرديين
│   └── {userId}/               # وثيقة المستخدم الفردي
│       ├── tasks/              # مهام المستخدم الفردي
│       └── reports/            # تقارير المستخدم الفردي
├── organizations/              # مجموعة المؤسسات
│   └── {orgId}/                # وثيقة المؤسسة
│       ├── members/            # أعضاء المؤسسة
│       │   └── {userId}/       # معلومات العضو في المؤسسة
│       ├── tasks/              # مهام المؤسسة
│       └── reports/            # تقارير المؤسسة
└── users/                      # معلومات المستخدمين المشتركة
    └── {userId}/               # معلومات المستخدم
```

## الأدوار والصلاحيات

### الأدوار المدعومة

- **admin**: مدير النظام (أعلى صلاحية)
- **engineer**: مهندس
- **supervisor**: مشرف
- **technician**: فني
- **assistant**: مساعد فني
- **user**: مستخدم عادي
- **independent**: مستخدم مستقل (فردي)

### مجالات الصلاحيات

- **users**: إدارة المستخدمين
- **tasks**: إدارة المهام
- **reports**: التقارير
- **settings**: الإعدادات
- **tools**: الأدوات
- **dashboard**: لوحة المعلومات
- **data**: إدارة البيانات (تصدير/استيراد)

### أنواع الصلاحيات

- **view**: عرض
- **create**: إنشاء
- **edit**: تعديل
- **delete**: حذف
- **approve**: موافقة/اعتماد
- **assign**: تعيين/إسناد

## الدوال المتاحة

### دوال المستخدمين الفرديين

- **createIndividualUser**: إنشاء مستخدم فردي جديد
- **getIndividualUserData**: الحصول على بيانات المستخدم الفردي
- **updateIndividualUserData**: تحديث بيانات المستخدم الفردي
- **exportIndividualData**: تصدير بيانات المستخدم الفردي
- **importIndividualData**: استيراد بيانات المستخدم الفردي

### دوال المؤسسات

- **createOrganization**: إنشاء مؤسسة جديدة
- **getOrganization**: الحصول على معلومات المؤسسة
- **updateOrganization**: تحديث معلومات المؤسسة
- **addOrganizationMember**: إضافة عضو إلى المؤسسة
- **removeOrganizationMember**: إزالة عضو من المؤسسة
- **getOrganizationMembers**: الحصول على أعضاء المؤسسة

### دوال إدارة الأدوار

- **updateUserRole**: تحديث دور المستخدم
- **updateUserPermissions**: تحديث صلاحيات المستخدم

### دوال إدارة النظام

- **getSystemSettings**: الحصول على إعدادات النظام
- **setupSystem**: إعداد النظام

## الخصوصية وفصل البيانات

تم تصميم النظام لضمان الخصوصية وفصل البيانات بين المستخدمين الفرديين والمؤسسات:

1. **المستخدمون الفرديون**:
   - يمكنهم الوصول إلى بياناتهم الخاصة فقط
   - يتم تخزين بياناتهم في مجموعة `individuals`
   - لديهم دور `independent`

2. **المؤسسات**:
   - يمكن لأعضاء المؤسسة الوصول إلى بيانات المؤسسة فقط
   - يتم تخزين بيانات المؤسسة في مجموعة `organizations`
   - يمكن للمديرين فقط إدارة المؤسسة وأعضائها

3. **قواعد الأمان**:
   - تم تنفيذ قواعد أمان Firestore لضمان الفصل بين البيانات
   - يتم التحقق من الصلاحيات في كل دالة

## كيفية النشر

```bash
# تثبيت التبعيات
npm install

# بناء المشروع
npm run build

# نشر الدوال
firebase deploy --only functions
```

## ملاحظات هامة

1. **الصلاحيات المخصصة**: يمكن تخصيص صلاحيات أي مستخدم بغض النظر عن دوره الأساسي.
2. **تصدير واستيراد البيانات**: يمكن للمستخدمين الفرديين تصدير واستيراد بياناتهم.
3. **الفصل بين البيانات**: لا يمكن لمديري المؤسسات الوصول إلى بيانات المستخدمين الفرديين.
