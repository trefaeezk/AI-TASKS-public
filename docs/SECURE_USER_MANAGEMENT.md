# ๐ ุงูุทุฑููุฉ ุงูุขููุฉ ูุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทููุฑ ูุธุงู ุขูู ูุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู ูุนุชูุฏ ุนูู Firebase Functions ููุทุ ููุง ูุถูู:

- **ุงูุฃูุงู**: ุฌููุน ุงูุนูููุงุช ุชุชู ุนุจุฑ Firebase Functions ุงููุญููุฉ
- **ุงูุชุญูู ูู ุงูุตูุงุญูุงุช**: ุงูุชุญูู ูู ุตูุงุญูุงุช ุงููุณุชุฎุฏู ูุจู ูู ุนูููุฉ
- **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก**: ูุนุงูุฌุฉ ุดุงููุฉ ููุฃุฎุทุงุก ูุน ุฑุณุงุฆู ูุงุถุญุฉ
- **ุชุญุฏูุซ ุงูุจูุงูุงุช**: ุชุญุฏูุซ ูุชุฒุงูู ูุฌููุน ูุตุงุฏุฑ ุงูุจูุงูุงุช (Auth, Custom Claims, Firestore)

## ๐๏ธ ุงูุจููุฉ

### 1. Firebase Functions (Backend)

#### `createUser`
- **ุงููุตู**: ุฅูุดุงุก ูุณุชุฎุฏู ุฌุฏูุฏ ุจุทุฑููุฉ ุขููุฉ
- **ุงููุชุทูุจุงุช**: ุตูุงุญูุงุช admin
- **ุงููุฏุฎูุงุช**: email, password, name, role, accountType, organizationId?, departmentId?
- **ุงููุฎุฑุฌุงุช**: { uid?, error? }

#### `updateUserRole`
- **ุงููุตู**: ุชุญุฏูุซ ุฏูุฑ ุงููุณุชุฎุฏู
- **ุงููุชุทูุจุงุช**: ุตูุงุญูุงุช admin
- **ุงููุฏุฎูุงุช**: { uid, role }
- **ุงููุฎุฑุฌุงุช**: { result?, error? }

#### `updateUserPermissions`
- **ุงููุตู**: ุชุญุฏูุซ ุตูุงุญูุงุช ุงููุณุชุฎุฏู ุงููุฎุตุตุฉ
- **ุงููุชุทูุจุงุช**: ุตูุงุญูุงุช admin
- **ุงููุฏุฎูุงุช**: { uid, permissions[] }
- **ุงููุฎุฑุฌุงุช**: { result?, error? }

#### `toggleUserDisabled`
- **ุงููุตู**: ุชูุนูู/ุฅูุบุงุก ุชูุนูู ุงููุณุชุฎุฏู
- **ุงููุชุทูุจุงุช**: ุตูุงุญูุงุช admin
- **ุงููุฏุฎูุงุช**: { uid, disabled }
- **ุงููุฎุฑุฌุงุช**: { result?, error? }

### 2. Frontend Hook

#### `useSecureUserManagement`
Hook ูุฎุตุต ูููุฑ ูุงุฌูุฉ ุขููุฉ ููุชูุงุนู ูุน Firebase Functions:

```typescript
const {
  createUser,
  updateUserRole,
  updateUserPermissions,
  toggleUserDisabled,
  isLoading
} = useSecureUserManagement();
```

## ๐ง ุงูุงุณุชุฎุฏุงู

### ุฅูุดุงุก ูุณุชุฎุฏู ุฌุฏูุฏ

```typescript
const handleCreateUser = async (userData: CreateUserInput) => {
  const result = await createUser(userData);
  
  if (result.success) {
    // ุชู ุฅูุดุงุก ุงููุณุชุฎุฏู ุจูุฌุงุญ
    console.log('User created with UID:', result.uid);
  } else {
    // ุญุฏุซ ุฎุทุฃ
    console.error('Error:', result.error);
  }
};
```

### ุชุญุฏูุซ ุฏูุฑ ุงููุณุชุฎุฏู

```typescript
const handleUpdateRole = async (userId: string, newRole: string) => {
  const result = await updateUserRole(userId, newRole);
  
  if (result.success) {
    // ุชู ุชุญุฏูุซ ุงูุฏูุฑ ุจูุฌุงุญ
  }
};
```

### ุชุญุฏูุซ ุงูุตูุงุญูุงุช

```typescript
const handleUpdatePermissions = async (userId: string, permissions: string[]) => {
  const result = await updateUserPermissions(userId, permissions);
  
  if (result.success) {
    // ุชู ุชุญุฏูุซ ุงูุตูุงุญูุงุช ุจูุฌุงุญ
  }
};
```

### ุชูุนูู/ุฅูุบุงุก ุชูุนูู ุงููุณุชุฎุฏู

```typescript
const handleToggleDisabled = async (userId: string, disabled: boolean) => {
  const result = await toggleUserDisabled(userId, disabled);
  
  if (result.success) {
    // ุชู ุชุญุฏูุซ ุญุงูุฉ ุงูุชูุนูู ุจูุฌุงุญ
  }
};
```

## ๐ก๏ธ ุงูุฃูุงู

### ุงูุชุญูู ูู ุงูุตูุงุญูุงุช

ุฌููุน Firebase Functions ุชุชุญูู ูู:
1. **ุงููุตุงุฏูุฉ**: ุงููุณุชุฎุฏู ูุณุฌู ุฏุฎูู
2. **ุงูุตูุงุญูุงุช**: ุงููุณุชุฎุฏู ูู ุตูุงุญูุงุช admin
3. **ุงูุจูุงูุงุช**: ุตุญุฉ ุงูุจูุงูุงุช ุงููุฑุณูุฉ

### ุงูุฃุฏูุงุฑ ุงููุฏุนููุฉ

- `system_owner`: ูุงูู ุงููุธุงู (ุฃุนูู ุตูุงุญูุฉ)
- `system_admin`: ูุฏูุฑ ุงููุธุงู
- `org_owner`: ูุงูู ุงููุคุณุณุฉ
- `org_admin`: ูุฏูุฑ ุงููุคุณุณุฉ
- `org_supervisor`: ูุดุฑู ุงููุคุณุณุฉ
- `org_engineer`: ูููุฏุณ ุงููุคุณุณุฉ
- `org_technician`: ููู ุงููุคุณุณุฉ
- `org_assistant`: ูุณุงุนุฏ ุงููุคุณุณุฉ
- `independent`: ูุณุชุฎุฏู ูุณุชูู

## ๐ ุชุญุฏูุซ ุงูุจูุงูุงุช

ุนูุฏ ุฅูุดุงุก ุฃู ุชุญุฏูุซ ูุณุชุฎุฏูุ ูุชู ุชุญุฏูุซ:

1. **Firebase Auth**: ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ (email, displayName, disabled)
2. **Custom Claims**: ุงูุฃุฏูุงุฑ ูุงูุตูุงุญูุงุช
3. **Firestore**: ุฌููุน ุจูุงูุงุช ุงููุณุชุฎุฏู ุงูุชูุตูููุฉ

## โ๏ธ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

### ุฃุฎุทุงุก ุดุงุฆุนุฉ

- `already-exists`: ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูุณุชุฎุฏู ุจุงููุนู
- `permission-denied`: ููุณ ูุฏูู ุตูุงุญูุฉ ููุฐู ุงูุนูููุฉ
- `invalid-argument`: ุจูุงูุงุช ุบูุฑ ุตุญูุญุฉ
- `unauthenticated`: ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู
- `internal`: ุฎุทุฃ ุฏุงุฎูู ูู ุงูุฎุงุฏู

### ุฑุณุงุฆู ุงููุณุชุฎุฏู

ูุชู ุนุฑุถ ุฑุณุงุฆู ูุงุถุญุฉ ูููุณุชุฎุฏู ุจุงููุบุฉ ุงูุนุฑุจูุฉ ููู ููุน ุฎุทุฃ.

## ๐ ุฃูุถู ุงูููุงุฑุณุงุช

1. **ุงุณุชุฎุฏู Hook ุฏุงุฆูุงู**: ูุง ุชุณุชุฏุนู Firebase Functions ูุจุงุดุฑุฉ
2. **ุชุญูู ูู ุงููุชุงุฆุฌ**: ุชุญูู ูู `result.success` ูุจู ุงููุชุงุจุนุฉ
3. **ูุนุงูุฌุฉ Loading**: ุงุณุชุฎุฏู `isLoading` ูุนุฑุถ ุญุงูุฉ ุงูุชุญููู
4. **ุชุญุฏูุซ ุงูุจูุงูุงุช**: ุฃุนุฏ ุชุญููู ุงูุจูุงูุงุช ุจุนุฏ ุงูุนูููุงุช ุงููุงุฌุญุฉ

## ๐ซ ูุง ุชู ุฅุฒุงูุชู

- **API Routes ุบูุฑ ุงูุขููุฉ**: ุชู ุญุฐู `/api/admin/create-user`
- **ุงุณุชุฏุนุงุกุงุช ูุจุงุดุฑุฉ**: ูุง ูุชู ุงุณุชุฏุนุงุก Firebase Auth ูุจุงุดุฑุฉ ูู Frontend
- **window.location.reload()**: ุชู ุงุณุชุจุฏุงููุง ุจุชุญุฏูุซ ุงูุจูุงูุงุช ุงููุญููุฉ

## ๐ฎ ุงููุณุชูุจู

- ุฅุถุงูุฉ ุงููุฒูุฏ ูู ุงูุนูููุงุช ุงูุขููุฉ
- ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
- ุฅุถุงูุฉ ุชุณุฌูู ุงูุนูููุงุช (Audit Log)
- ุฏุนู ุงูุนูููุงุช ุงููุฌูุนุฉ (Batch Operations)
